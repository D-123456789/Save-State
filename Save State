-- Save State script
-- Mobile Friendly
local stored = UDim2.new(0,0,-0.08,0)
-- Update v7, fixed the attempted to index nil with position in the mobile functions.
wait(2)
-- Character finding Varibles
local Players = game:GetService("Players")
local player = game:GetService("Players").LocalPlayer
local character = player.Character
local UIS = game:GetService("UserInputService")
local Mouse = player:GetMouse()
local Previewation = false
local Save_State_Part
local Saved_Stated = false
local HRP = character:WaitForChild("HumanoidRootPart")
local CanTeleport = true
-- Sound variables | The save state sound
local Sound = Instance.new("Sound")
Sound.Parent = game.SoundService
Sound.SoundId = "rbxassetid://77457926931973"
Sound.Volume = 10
-- #2 | Teleport sound
local Sound2 = Instance.new("Sound")
Sound2.Parent = game.SoundService
Sound2.SoundId = "rbxassetid://3140269034"
Sound2.Volume = 10
-- #3 | PC Sound
local Sound3 = Instance.new("Sound")
Sound3.Parent = game.SoundService
Sound3.SoundId = "rbxassetid://18996974946"
Sound3.Volume = 10
-- #4 | Mobile Sound
local Sound4 = Instance.new("Sound")
Sound4.Parent = game.SoundService
Sound4.SoundId = "rbxassetid://138721734757982"
Sound4.Volume = 10
-- If HRP is true then works
if HRP then
	print("Hrp" .. " - Client")
else
	print("No Hrp" .. " - Client")
end
-- Replicated first Gui
-- The screenGUI base for everything in mobile and replicated/Loaded first
local ScreenMobile = Instance.new("ScreenGui")
ScreenMobile.Parent = player:WaitForChild("PlayerGui")
ScreenMobile.Enabled = true
ScreenMobile.ResetOnSpawn = false
-- The title/Custom Hint for this script
local TitleTP = Instance.new("TextLabel")
TitleTP.Size = UDim2.new(1,0,0.05,0)
TitleTP.Position = UDim2.new(0,0,0.5,0)
TitleTP.Parent = ScreenMobile
TitleTP.BackgroundTransparency = 0.25
TitleTP.TextColor = BrickColor.new("Black")
TitleTP.BorderSizePixel = 6
TitleTP.Text = "Save state script!!11!! Press F to save state!!11! Press G to Teleport!!(For PC!!1!) (Dont spam!!1!)"
TitleTP.TextScaled = true
task.delay(5, function()
	game.TweenService:Create(TitleTP, TweenInfo.new(2, Enum.EasingStyle.Exponential), {Position = TitleTP.Position + UDim2.new(0,0,-2,0)}):Play()
end)
task.delay(6, function()
	game.TweenService:Create(TitleTP, TweenInfo.new(1, Enum.EasingStyle.Linear), {Transparency = 1}):Play()
	wait(5)
	TitleTP:Destroy()
end)
local function onCharacterAdded(char)
	character = char
	HRP = char:WaitForChild("HumanoidRootPart")
end
-- Everything above this line is replicated/Loaded first to the player
task.delay(3, function()
	-- Checks if the player is on mobile or pc to save memory on pc to mobile functions.
	if game.UserInputService.KeyboardEnabled and game.UserInputService.MouseEnabled and not game.UserInputService.TouchEnabled then
		-- Make sure to make new character and hrp if the player dies
		task.spawn(function()
			while task.wait(0.0001) do
				if character.Humanoid.Health == 0 then
					-- sets new Charatcer
					if player.CharacterAdded then
						onCharacterAdded(player.Character)
					end
				end
			end
		end)
		wait(1)
		print("Pc user, Script started")
		Sound3:Play()
		-- F key Save State
		UIS.InputBegan:Connect(function(input, proc)
			if input.KeyCode == Enum.KeyCode.F and not Saved_Stated and CanTeleport then
				Saved_Stated = true
				if Saved_Stated then
					-- F key part.
					Sound2:Play()
					Save_State_Part = Instance.new("Part")
					Save_State_Part.Parent = workspace
					Save_State_Part.Rotation = Vector3.new(0,0,90)
					Save_State_Part.Size = Vector3.new(2048,4.3,4.3)
					Save_State_Part.Anchored = true
					Save_State_Part.Color = Color3.new(0.133333, 1, 0)
					Save_State_Part.Transparency = 0.5
					Save_State_Part.Position = HRP.Position + Vector3.new(0,-3,0)
					Save_State_Part.CanCollide = false
					Save_State_Part.Shape = "Cylinder"
					Save_State_Part.Material = "Neon"
				end
			end
			-- G key Teleport State
			if input.KeyCode == Enum.KeyCode.G and Saved_Stated and CanTeleport then
				Sound:Play()
				character:PivotTo(CFrame.new(Save_State_Part.Position + Vector3.new(0,3.99,0)))
				Save_State_Part.Parent = nil
				Save_State_Part:Destroy()
				Save_State_Part = nil
				Saved_Stated = false
				-- sets new Charatcer
				if player.CharacterAdded then
					onCharacterAdded(player.Character)
				end
			end
		end)
	elseif not game.UserInputService.KeyboardEnabled and not game.UserInputService.MouseEnabled and game.UserInputService.TouchEnabled then
		task.spawn(function()
			while task.wait(0.0001) do
				if character.Humanoid.Health == 0 then
					-- sets new Charatcer
					if player.CharacterAdded then
						onCharacterAdded(player.Character)
					end
				end
			end
		end)
		wait(1)
		print("Mobile User, Script started")
		Sound4:Play()
		-- Frame for buttons
		local FrameTp = Instance.new("Frame")
		FrameTp.Parent = ScreenMobile
		FrameTp.Size = UDim2.new(0.3,0,0.3,0)
		FrameTp.Position = UDim2.new(1,0,0.23,0)
		FrameTp.BackgroundColor = BrickColor.new("Ghost grey")
		local FrameTPround = Instance.new("UICorner")
		FrameTPround.Parent = FrameTp
		task.delay(0.2, function()
			task.spawn(function()
				while task.wait(1) do
					FrameTp.BackgroundColor3 = Color3.fromRGB(188, 188, 188)
					wait(1)
					FrameTp.BackgroundColor3 = Color3.fromRGB(68, 68, 68)
				end
			end)
		end)
		FrameTp.BorderColor3 = Color3.fromRGB(0, 0, 0)
		local FrameTpcorner = Instance.new("UIStroke")
		FrameTpcorner.Parent = FrameTp
		FrameTpcorner.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
		FrameTpcorner.Thickness = 6
		game.TweenService:Create(FrameTp, TweenInfo.new(2, Enum.EasingStyle.Exponential), {Position = FrameTp.Position + UDim2.new(-0.19,0,0,0)}):Play()
		-- The open and clsoe button at bottom right
		local Close_OpenButton = Instance.new("TextButton")
		Close_OpenButton.Transparency = 1
		Close_OpenButton.Text = "Open and Close Button"
		Close_OpenButton.TextScaled = true
		Close_OpenButton.TextStrokeTransparency = 0
		task.delay(0.5, function()
			game.TweenService:Create(Close_OpenButton, TweenInfo.new(2, Enum.EasingStyle.Exponential), {Transparency = 0}):Play()
			game.TweenService:Create(Close_OpenButton, TweenInfo.new(2.5, Enum.EasingStyle.Exponential), {Position = Close_OpenButton.Position + UDim2.new(-0.301,0,0,0)}):Play()
		end)
		Close_OpenButton.Parent = ScreenMobile
		Close_OpenButton.Size = UDim2.new(0.1,0,0.1)
		Close_OpenButton.Position = UDim2.new(1.2,0,0.9,0)
		Close_OpenButton.BorderSizePixel = 6
		Close_OpenButton.TextColor = BrickColor.new("Ghost grey")
		local CTP2 = Instance.new("UIStroke")
		CTP2.Parent = Close_OpenButton
		CTP2.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
		CTP2.Thickness = 6
		CTP2.Color = Color3.fromRGB(0, 0, 0)
		FrameTp.BackgroundColor = BrickColor.new("Black metallic")
		task.delay(2.5, function()
			Close_OpenButton.MouseButton1Click:Connect(function()
				FrameTp.Visible = not FrameTp.Visible
			end)
		end)
		task.delay(0.2, function()
			task.spawn(function()
				while task.wait(1) do
					Close_OpenButton.BackgroundColor3 = Color3.fromRGB(68, 68, 68)
					wait(1)
					Close_OpenButton.BackgroundColor3 = Color3.fromRGB(188, 188, 188)
				end
			end)
		end)
		local FrameTProun = Instance.new("UICorner")
		FrameTProun.Parent = Close_OpenButton
		-- Saving State button
		local SaveMobile = Instance.new("TextButton")
		SaveMobile.Parent = FrameTp
		SaveMobile.Size = UDim2.new(0.5, 0, 0.35, 0)
		SaveMobile.Position = UDim2.new(0.05,0,0.1,0)
		SaveMobile.BackgroundColor = BrickColor.new("Silver")
		SaveMobile.TextScaled = true
		SaveMobile.Text = "Save State"
		SaveMobile.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
		SaveMobile.TextStrokeTransparency = 0
		SaveMobile.TextStrokeColor3 = Color3.fromRGB(255, 255, 255)
		local SaveMobileCorner = Instance.new("UIStroke")
		SaveMobileCorner.Parent = SaveMobile
		SaveMobileCorner.Thickness = 6
		SaveMobileCorner.ApplyStrokeMode =Enum.ApplyStrokeMode.Border
		local FrameTProu = Instance.new("UICorner")
		FrameTProu.Parent = SaveMobile
		-- Teleporting to saved state button
		local SaveMobile2 = Instance.new("TextButton")
		SaveMobile2.Parent = FrameTp
		SaveMobile2.Position = UDim2.new(0.05,0,0.6,0)
		SaveMobile2.BackgroundColor = BrickColor.new("Silver")
		SaveMobile2.Size = UDim2.new(0.5, 0, 0.35, 0)
		SaveMobile2.TextScaled = true
		SaveMobile2.Text = "TP State"
		SaveMobile2.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
		SaveMobile2.TextStrokeTransparency = 0
		SaveMobile2.TextStrokeColor3 = Color3.fromRGB(255, 255, 255)
		local SaveMobileCorner2 = Instance.new("UIStroke")
		SaveMobileCorner2.Parent = SaveMobile2
		SaveMobileCorner2.Thickness = 6
		SaveMobileCorner2.ApplyStrokeMode =Enum.ApplyStrokeMode.Border
		local FrameTPro = Instance.new("UICorner")
		FrameTPro.Parent = SaveMobile2
		-- Save State button
		SaveMobile.MouseButton1Click:Connect(function()
			Saved_Stated = true
			if Saved_Stated and CanTeleport then
				-- The save state viewer function
				Sound2:Play()
				Save_State_Part = Instance.new("Part")
				Save_State_Part.Parent = workspace
				Save_State_Part.Rotation = Vector3.new(0,0,90)
				Save_State_Part.Size = Vector3.new(2048,4.3,4.3)
				Save_State_Part.Anchored = true
				Save_State_Part.Color = Color3.new(0.133333, 1, 0)
				Save_State_Part.Transparency = 0.5
				Save_State_Part.Position = HRP.Position + Vector3.new(0,-3,0)
				Save_State_Part.CanCollide = false
				Save_State_Part.Shape = "Cylinder"
				Save_State_Part.Material = "Neon"
			end
			-- Teleport State Buttom
			SaveMobile2.MouseButton1Click:Connect(function()
				-- State teleporter function
				if Saved_Stated and CanTeleport then
					Sound:Play()
					character:PivotTo(CFrame.new(Save_State_Part.Position + Vector3.new(0,3.99,0)))
					Save_State_Part.Parent = nil
					Save_State_Part:Destroy()
					Save_State_Part = nil
					Saved_Stated = false
				end
			end)
		end)
	else
		warn("Something Went wrong. couldnt load mobile, try loading script again")
		TitleTP:Destroy()
		ScreenMobile:Destroy()
		Sound:Destroy()
		Sound2:Destroy()
		Sound3:Destroy()
		Sound4:Destroy()
		print("ScreenGui unloaded, sounds unloaded.")
	end
end)
